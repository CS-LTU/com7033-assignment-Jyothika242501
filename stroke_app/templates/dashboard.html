{% extends "base.html" %}
{% block content %}

<div class="container mt-4">

    <h2 class="fw-bold">Patient Analytics Dashboard</h2>
    <p class="text-muted mb-4">
        Overview of anonymised patient records related to stroke and cardiovascular risk.
    </p>

    <!-- STAT CARDS ROW -->
    <div class="row g-4">

        <!-- TOTAL PATIENTS -->
        <div class="col-md-3">
            <div class="card shadow-sm border-0 text-white" style="background:#333;">
                <div class="card-body">
                    <h6 class="text-uppercase small">Total Patients</h6>
                    <h2 class="fw-bold">{{ total }}</h2>
                    <p class="small mb-0">All records in system</p>
                </div>
            </div>
        </div>

        <!-- STROKE CASES -->
        <div class="col-md-3">
            <div class="card shadow-sm border-0 text-white" style="background:#0d6efd;">
                <div class="card-body">
                    <h6 class="text-uppercase small">Stroke Cases</h6>
                    <h2 class="fw-bold">{{ strokes }}</h2>
                    <p class="small mb-0">Patients with stroke recorded</p>
                </div>
            </div>
        </div>

        <!-- HYPERTENSION -->
        <div class="col-md-3">
            <div class="card shadow-sm border-0 text-white" style="background:#198754;">
                <div class="card-body">
                    <h6 class="text-uppercase small">Hypertension</h6>
                    <h2 class="fw-bold">{{ hypertension }}</h2>
                    <p class="small mb-0">Patients with hypertension</p>
                </div>
            </div>
        </div>

        <!-- HEART DISEASE -->
        <div class="col-md-3">
            <div class="card shadow-sm border-0 text-white" style="background:#dc3545;">
                <div class="card-body">
                    <h6 class="text-uppercase small">Heart Disease</h6>
                    <h2 class="fw-bold">{{ heart_disease }}</h2>
                    <p class="small mb-0">Patients with heart disease</p>
                </div>
            </div>
        </div>

    </div>

    <!-- CHARTS SECTION -->
    <div class="row mt-5 g-4">

        <!-- HEART DISEASE DESCRIPTION -->
        <div class="col-md-6">
            <h5 class="fw-bold">Heart Disease Distribution</h5>
            <p class="text-muted small">Patients with and without recorded heart disease.</p>

            <canvas id="heartChart"></canvas>
        </div>

        <!-- GENDER & STROKE -->
        <div class="col-md-6">
            <h5 class="fw-bold">Stroke Cases by Gender</h5>
            <p class="text-muted small">Distribution of stroke cases across patient gender.</p>

            <canvas id="genderChart"></canvas>
        </div>

    </div>

</div>

<!-- CHART.JS -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    // --------------------
    // HEART DISEASE CHART
    // --------------------
    const heartCtx = document.getElementById('heartChart').getContext('2d');
    new Chart(heartCtx, {
        type: 'pie',
        data: {
            labels: ['Heart Disease', 'No Heart Disease'],
            datasets: [{
                data: [{{ heart_disease }}, {{ total - heart_disease }}],
                backgroundColor: ['#dc3545', '#6c757d']
            }]
        }
    });

    // --------------------
    // GENDER CHART
    // --------------------
    const genderCtx = document.getElementById('genderChart').getContext('2d');
    new Chart(genderCtx, {
        type: 'bar',
        data: {
            labels: ['Male', 'Female'],
            datasets: [{
                label: 'Stroke Cases',
                data: [{{ male }}, {{ female }}],
                backgroundColor: ['#0d6efd', '#d63384']
            }]
        }
    });
</script>

{% endblock %}
